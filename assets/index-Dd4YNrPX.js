import{h as J,i as A,E as G,M as y}from"./GameInfo-KBkgcGKJ.js";import{W as E,g as p}from"./workflow-B0jYlNl-.js";import{g as N}from"./index.vue_vue_type_script_setup_true_lang-BTWGwO90.js";import{w as x,l as k,x as u}from"./index-CMIaIRUM.js";import{h as q,b as U,c as z,d as C}from"./ManualPriceCard-CYFf2-hT.js";import{y as B}from"./vue-CMGQ9A1z.js";const{t:F}=k.global;async function K(i,f="jungle"){let t=[];if(x().getJungleCache(f))t=x().getJungleCache(f);else{await new Promise(n=>setTimeout(n,300));const e=Date.now();try{t=t.concat(await Q())}catch(n){console.error(n)}x().setJungleCache(t,f),B.success(F("计算完成，耗时{0}秒",[(Date.now()-e)/1e3]))}t=t.filter(e=>i.maxLevel?e.calculator.enhanceLevel<=i.maxLevel:!0),t=t.filter(e=>i.minLevel?e.calculator.enhanceLevel>=i.minLevel:!0),t=t.filter(e=>i.minSellPrice?e.calculator.productListWithPrice[0].price>=i.minSellPrice*1e6:!0),t=t.filter(e=>i.maxSellPrice?e.calculator.productListWithPrice[0].price<=i.maxSellPrice*1e6:!0);const m=i.minItemLevel!==void 0&&i.minItemLevel!==null&&i.minItemLevel!=="",r=i.maxItemLevel!==void 0&&i.maxItemLevel!==null&&i.maxItemLevel!=="";if(t=t.filter(e=>m?e.calculator.item.itemLevel>=Number(i.minItemLevel):!0),t=t.filter(e=>r?e.calculator.item.itemLevel<=Number(i.maxItemLevel):!0),i.bestManufacture){const e={};t.forEach(n=>{const a=`${n.calculator.hrid}-${n.calculator.enhanceLevel}`;(!e[a]||e[a].result.profitPH<n.result.profitPH)&&(e[a]=n)}),t=Object.values(e)}return q(U(z(t,i),i),i)}async function Q(){var m;const i=J(),f=Object.values(i.itemDetailMap).filter(r=>r.enhancementCosts),t=[];for(const r of f)for(let e=1;e<=20;e++){if(A(r.hrid,e,"bid")===-1)continue;let n=-1/0,a,M=-1/0,g;const d=[],P=[],h=N(r)==="charm"?7:2;for(let l=0;l<=h;l++)d[l]=-1/0,P[l]=void 0;for(let l=e>2?2:e;l<=e;l++){const o=new G({enhanceLevel:e,protectLevel:l,hrid:r.hrid}),H=[[u("锻造"),"cheesesmithing"],[u("制造"),"crafting"],[u("裁缝"),"tailoring"]];for(const[D,O]of H)for(const[I,W]of H){const v=new y({hrid:r.hrid,project:I,action:W});if(!o.available||(o.run(),o.result.profitPH>M&&(M=o.result.profitPH,g=o),!v.available))continue;const L=new E([p(v),p(o)],`${I} → ${u("强化")}+${e}`);L.run();const $=[];let b=v;const w=[v];let S=1;for(;(m=b.actionItem)!=null&&m.upgradeItemHrid&&S<h;){const c=new y({hrid:b.actionItem.upgradeItemHrid,project:D,action:O});if(!c.available)break;w.unshift(c),S++;const s=[...w.map(T=>p(T)),p(o)],j=new E(s,`${S}${u("步")}${I} → ${u("强化")}+${e}`);j.run(),$.push(j),b=c}L.result.profitPH>n&&(n=L.result.profitPH,a=L),$.forEach(c=>{const s=c.calculatorList.length-1;s>=2&&s<=h&&c.result.profitPH>d[s]&&(d[s]=c.result.profitPH,P[s]=c)})}}a&&C(t,a),g&&C(t,g);for(let l=2;l<=h;l++){const o=P[l];o&&C(t,o)}}return t}export{K as g};
