import{y as oe,k as se,r as L,aJ as ie,w as J,u as re,f as z,i,s as a,q as l,at as ce,v as t,a5 as W,av as ue,au as de,aK as pe,ao as me,aL as fe,p as R,G as d,ax as he,D as I,F as o,Y as T,az as ge,aM as _e,a0 as ve,V as Le,n as ye,O as be,P as xe,aN as Ce,aw as Pe,aO as ke,aP as De,aD as Ee,ay as Se,aR as q,aS as Ve,h as y}from"./vue-CMGQ9A1z.js";import{_ as j}from"./index.vue_vue_type_script_setup_true_lang-BTWGwO90.js";import{h as we,b as Fe,c as ze,d as Re,u as Ie,a as Me,A as Te,_ as je,M as Ae}from"./ManualPriceCard-CYFf2-hT.js";import{h as He,i as $e,E as Be,D as Ne,G as Oe,A as Ue,e as Ge,f as A,d as Je,u as We}from"./GameInfo-KBkgcGKJ.js";import{W as qe,g as K}from"./workflow-B0jYlNl-.js";import{w as H,l as Ke,x as Ye}from"./index-CMIaIRUM.js";import{_ as Ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const{t:Qe}=Ke.global;async function Xe(f){let s=[];if(H().getJungleCache("enhanposest"))s=H().getJungleCache("enhanposest");else{await new Promise(b=>setTimeout(b,300));const h=Date.now();try{s=s.concat(et())}catch(b){console.error(b)}H().setJungleCache(s,"enhanposest"),oe.success(Qe("计算完成，耗时{0}秒",[(Date.now()-h)/1e3]))}return s=s.filter(h=>f.maxLevel?h.calculator.enhanceLevel<=f.maxLevel:!0),s=s.filter(h=>f.minLevel?h.calculator.enhanceLevel>=f.minLevel:!0),we(Fe(ze(s,f),f),f)}function et(){const f=He(),s=Object.values(f.itemDetailMap),h=[],b=[-1,0,5,6,7,8,9,10,11,12,13,14,15],k=[5,6,7,8,9,10,11,12,13,14,15,16],M=[10,11,12,13,14,15,16,17,18,19,20];return s.filter(c=>c.enhancementCosts).forEach(c=>{for(const p of M.reverse()){let x=-1/0,C;for(const _ of k)if($e(c.hrid,_,"ask")!==-1){for(const w of b)if(!(_>=p||w>=_))for(let P=p>2?2:p;P<=p;P++){const v=new Be({enhanceLevel:p,escapeLevel:w,originLevel:_,protectLevel:P,hrid:c.hrid});if(!(!v.available||!v.profitable))for(let D=0;D<=2;D++){const g=new qe([K(v),K(new Ne({enhanceLevel:p,hrid:c.hrid,catalystRank:D}))],`+${_} ${Ye("→")} +${p}`);g.run(),g.result.profitPH>x&&(x=g.result.profitPH,C=g)}}}C&&Re(h,C)}}),h}const tt={class:"app-container"},at={class:"game-info"},lt={class:"title"},nt={style:{display:"flex"}},ot={key:0},st={style:{display:"flex","justify-content":"center","align-items":"center",gap:"5px"}},it={style:{display:"flex","justify-content":"center","align-items":"center",gap:"5px"}},rt={style:{display:"flex","justify-content":"center","align-items":"center",gap:"5px"}},ct={style:{display:"flex","justify-content":"center","align-items":"center",gap:"5px"}},ut={style:{display:"flex","justify-content":"center","align-items":"center",gap:"5px"}},dt={class:"pager-wrapper"},pt=se({__name:"enhanposest",setup(f){const{paginationData:s,handleCurrentChange:h,handleSizeChange:b}=Ie({},"enhanposest-leaderboard-pagination"),k=L([]),M=L(null),c=Me("enhanposest-leaderboard-search-data",{name:"",project:"",profitRate:"",maxLevel:20,minLevel:1,banEquipment:!1}),p=L(!1),x=ie(()=>{p.value=!0,Xe({currentPage:s.currentPage,size:s.pageSize,...c.value,sort:_.value}).then(m=>{s.total=m.total,k.value=m.list}).catch(m=>{console.error(m),k.value=[]}).finally(()=>{p.value=!1})},300);function C(){s.currentPage===1?x():s.currentPage=1,JSON.stringify(c.value)}const _=L();function w(m){_.value=m,x()}J([()=>s.currentPage,()=>s.pageSize,()=>Je(),()=>We().config],x,{immediate:!0}),J(()=>A(),()=>{x()},{deep:!0});const P=L(),v=L(!1);async function D(m){P.value=q(m),v.value=!0}const g=L(!1),$=L();function Y(m){if(!A().activated){Ve.confirm(n("是否确定开启自定义价格？"),n("需先开启自定义价格"),{confirmButtonText:n("确定"),cancelButtonText:n("取消"),closeOnClickModal:!0}).then(()=>{A().setActivated(!0)});return}$.value=q(m),g.value=!0}const{t:n}=re();return(m,r)=>{const Z=Ee,B=De,N=Se,Q=ke,u=he,O=ge,E=ye("Warning"),S=Le,V=ve,X=Pe,ee=pe,te=de,U=ue,ae=ce,le=fe;return y(),z("div",tt,[i("div",at,[a(Oe),i("div",null,[a(Ue,{actions:["enhancing"],equipments:["hands","neck","earrings","ring","pouch"]})])]),a(ae,{gutter:20,class:"row"},{default:l(()=>[a(U,{xs:24,sm:24,md:24,lg:24,xl:14},{default:l(()=>[a(te,null,{header:l(()=>[a(Q,{class:"rank-card",ref_key:"ldSearchFormRef",ref:M,inline:!0,model:t(c)},{default:l(()=>[i("div",lt,o(t(n)("利润排行")),1),a(B,{prop:"name",label:t(n)("物品")},{default:l(()=>[a(Z,{style:{width:"100px"},modelValue:t(c).name,"onUpdate:modelValue":r[0]||(r[0]=e=>t(c).name=e),placeholder:t(n)("请输入"),clearable:"",onInput:C},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(B,{label:t(n)("目标等级从")},{default:l(()=>[a(N,{style:{width:"80px"},min:1,max:20,modelValue:t(c).minLevel,"onUpdate:modelValue":r[1]||(r[1]=e=>t(c).minLevel=e),placeholder:"1",clearable:"",onChange:C,"controls-position":"right"},null,8,["modelValue"]),d(" "+o(t(n)("到"))+"  ",1),a(N,{style:{width:"80px"},min:1,max:20,modelValue:t(c).maxLevel,"onUpdate:modelValue":r[2]||(r[2]=e=>t(c).maxLevel=e),placeholder:"20",clearable:"",onChange:C,"controls-position":"right"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:l(()=>[me((y(),R(X,{data:t(k),onSortChange:w},{default:l(()=>[a(u,{width:"54",fixed:"left"},{default:l(({row:e})=>[a(j,{hrid:e.hrid},null,8,["hrid"])]),_:1}),a(u,{prop:"result.name",label:t(n)("物品")},null,8,["label"]),a(u,{"min-width":"90"},{default:l(({row:e})=>[i("div",nt,[e.calculatorList&&e.calculatorList[0].protectLevel<e.calculatorList[0].enhanceLevel?(y(),R(j,{key:0,hrid:e.calculatorList[0].protectionItem.hrid},null,8,["hrid"])):I("",!0),e.catalyst?(y(),R(j,{key:1,hrid:`/items/${e.catalyst}`},null,8,["hrid"])):I("",!0)]),e.calculatorList&&e.calculatorList[0].protectLevel<e.calculatorList[0].enhanceLevel?(y(),z("div",ot,o(t(n)("从{0}保护",[e.calculatorList[0].protectLevel])),1)):I("",!0)]),_:1}),a(u,{prop:"project",label:t(n)("动作"),"min-width":"100"},null,8,["label"]),a(u,{label:t(n)("逃逸"),"min-width":"60"},{default:l(({row:e})=>[d(o(e.calculatorList[0].realEscapeLevel),1)]),_:1},8,["label"]),a(u,{prop:"result.profitPHFormat",label:t(n)("利润 / h"),align:"center","min-width":"120"},{default:l(({row:e})=>[i("span",{class:T(e.hasManualPrice?"manual":"")},o(e.result.profitPHFormat)+"  ",3),a(O,{type:"primary",icon:t(_e),onClick:F=>Y(e)},{default:l(()=>[d(o(t(n)("自定义")),1)]),_:2},1032,["icon","onClick"])]),_:1},8,["label"]),r[8]||(r[8]=d(" Z ")),a(u,{align:"center","min-width":"120"},{header:l(()=>[i("div",st,[i("div",null,o(t(n)("损耗 / h")),1),a(V,{placement:"top",effect:"light"},{content:l(()=>[d(o(t(n)("材料损耗+逃逸损耗")),1)]),default:l(()=>[a(S,null,{default:l(()=>[a(E)]),_:1})]),_:1})])]),default:l(({row:e})=>[i("span",null,o(e.calculatorList[0].result.cost4EnhancePHFormat),1)]),_:1}),a(u,{align:"center","min-width":"120"},{header:l(()=>[i("div",it,[i("div",null,o(t(n)("风险系数")),1),a(V,{placement:"top",effect:"light"},{content:l(()=>[d(o(t(n)("损耗 / 利润")),1)]),default:l(()=>[a(S,null,{default:l(()=>[a(E)]),_:1})]),_:1})])]),default:l(({row:e})=>[i("span",{class:T({error:e.result.risk>7,success:e.result.risk<5})},o(e.result.profitPH>0?e.result.riskFormat:""),3)]),_:1}),a(u,{align:"center","min-width":"100"},{header:l(()=>[i("div",rt,[i("div",null,o(t(n)("利润 / 次")),1),a(V,{placement:"top",effect:"light"},{content:l(()=>[d(o(t(n)("单次动作产生的利润。"))+" ",1),r[5]||(r[5]=i("br",null,null,-1)),d(" "+o(t(n)("#多步动作利润提示"))+" ",1),r[6]||(r[6]=i("br",null,null,-1)),d(" "+o(t(n)("#多步动作利润举例")),1)]),default:l(()=>[a(S,null,{default:l(()=>[a(E)]),_:1})]),_:1})])]),default:l(({row:e})=>[i("span",{class:T(e.hasManualPrice?"manual":"")},o(e.result.profitPPFormat)+"  ",3)]),_:1}),a(u,{prop:"result.profitRate",label:t(n)("利润率"),"min-width":"100",align:"center",sortable:"custom","sort-orders":["descending",null]},{default:l(({row:e})=>[d(o(e.result.profitRateFormat),1)]),_:1},8,["label"]),a(u,{label:t(n)("买价"),align:"center"},{default:l(({row:e})=>[i("span",null,o(Ge(e.calculatorList[0].ingredientListWithPrice[0].price)),1)]),_:1},8,["label"]),a(u,{prop:"result.targetRateFormat",label:t(n)("成功率"),align:"center","min-width":"100"},{header:l(()=>[i("div",ct,[i("div",null,o(t(n)("成功率")),1),a(V,{placement:"top",effect:"light"},{content:l(()=>r[7]||(r[7]=[d(" 单件装备的强化成功率 ")])),default:l(()=>[a(S,null,{default:l(()=>[a(E)]),_:1})]),_:1})])]),default:l(({row:e})=>[d(o(e.calculatorList[0].result.targetRateFormat),1)]),_:1},8,["label"]),a(u,{"min-width":"120",label:t(n)("经验 / h"),align:"center"},{default:l(({row:e})=>{var F;return[i("div",ut,[i("div",null,o(e.result.expPHFormat),1),((F=e.expList)==null?void 0:F.length)>1?(y(),R(V,{key:0,placement:"top",effect:"light"},{content:l(()=>[(y(!0),z(be,null,xe(e.expList,(G,ne)=>(y(),z("div",{key:ne,style:{display:"flex",gap:"10px"}},[i("div",null,o(t(n)(G.action)),1),i("div",null,o(G.expPHFormat),1)]))),128))]),default:l(()=>[a(S,null,{default:l(()=>[a(E)]),_:1})]),_:2},1024)):I("",!0)])]}),_:1},8,["label"]),a(u,{label:t(n)("详情"),align:"center"},{default:l(({row:e})=>[a(O,{type:"primary",icon:t(Ce),onClick:F=>D(e)},{default:l(()=>[d(o(t(n)("查看")),1)]),_:2},1032,["icon","onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[le,t(p)]])]),footer:l(()=>[i("div",dt,[a(ee,{background:"",layout:t(s).layout,"page-sizes":t(s).pageSizes,total:t(s).total,"page-size":t(s).pageSize,"current-page":t(s).currentPage,onSizeChange:t(b),onCurrentChange:t(h)},null,8,["layout","page-sizes","total","page-size","current-page","onSizeChange","onCurrentChange"])])]),_:1})]),_:1}),a(U,{xs:24,sm:24,md:24,lg:24,xl:10},{default:l(()=>[a(Ae,{"memory-key":"enhanposest"})]),_:1})]),_:1}),a(Te,{modelValue:t(v),"onUpdate:modelValue":r[3]||(r[3]=e=>W(v)?v.value=e:null),data:t(P)},null,8,["modelValue","data"]),a(je,{modelValue:t(g),"onUpdate:modelValue":r[4]||(r[4]=e=>W(g)?g.value=e:null),data:t($)},null,8,["modelValue","data"])])}}}),yt=Ze(pt,[["__scopeId","data-v-d294a367"]]);export{yt as default};
