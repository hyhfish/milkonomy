import{i as J,j as A,E as G,M as y}from"./GameInfo-CD_tVD5Z.js";import{W as E,g as p}from"./useMemory-r0PnY6ha.js";import{g as N}from"./index.vue_vue_type_script_setup_true_lang-CjRkRCNG.js";import{w as x,l as k,x as u}from"./index-DYCH4vBP.js";import{h as q,a as U,b as z,c as C}from"./ManualPriceCard-CZUTLASV.js";import{y as B}from"./vue-0ucuI9Mt.js";const{t:F}=k.global;async function K(i,f="jungle"){let t=[];if(x().getJungleCache(f))t=x().getJungleCache(f);else{await new Promise(n=>setTimeout(n,300));const e=Date.now();try{t=t.concat(await Q())}catch(n){console.error(n)}x().setJungleCache(t,f),B.success(F("计算完成，耗时{0}秒",[(Date.now()-e)/1e3]))}t=t.filter(e=>i.maxLevel?e.calculator.enhanceLevel<=i.maxLevel:!0),t=t.filter(e=>i.minLevel?e.calculator.enhanceLevel>=i.minLevel:!0),t=t.filter(e=>i.minSellPrice?e.calculator.productListWithPrice[0].price>=i.minSellPrice*1e6:!0),t=t.filter(e=>i.maxSellPrice?e.calculator.productListWithPrice[0].price<=i.maxSellPrice*1e6:!0);const m=i.minItemLevel!==void 0&&i.minItemLevel!==null&&i.minItemLevel!=="",r=i.maxItemLevel!==void 0&&i.maxItemLevel!==null&&i.maxItemLevel!=="";if(t=t.filter(e=>m?e.calculator.item.itemLevel>=Number(i.minItemLevel):!0),t=t.filter(e=>r?e.calculator.item.itemLevel<=Number(i.maxItemLevel):!0),i.bestManufacture){const e={};t.forEach(n=>{const c=`${n.calculator.hrid}-${n.calculator.enhanceLevel}`;(!e[c]||e[c].result.profitPH<n.result.profitPH)&&(e[c]=n)}),t=Object.values(e)}return q(U(z(t,i),i),i)}async function Q(){var m;const i=J(),f=Object.values(i.itemDetailMap).filter(r=>r.enhancementCosts),t=[];for(const r of f)for(let e=1;e<=20;e++){if(A(r.hrid,e,"bid")===-1)continue;let n=-1/0,c,M=-1/0,g;const d=[],P=[],h=N(r)==="charm"?7:2;for(let l=0;l<=h;l++)d[l]=-1/0,P[l]=void 0;for(let l=e>2?2:e;l<=e;l++){const o=new G({enhanceLevel:e,protectLevel:l,hrid:r.hrid}),H=[[u("锻造"),"cheesesmithing"],[u("制造"),"crafting"],[u("裁缝"),"tailoring"]];for(const[D,O]of H)for(const[I,W]of H){const v=new y({hrid:r.hrid,project:I,action:W});if(!o.available||(o.run(),o.result.profitPH>M&&(M=o.result.profitPH,g=o),!v.available))continue;const L=new E([p(v),p(o)],`${I} → ${u("强化")}+${e}`);L.run();const $=[];let b=v;const j=[v];let S=1;for(;(m=b.actionItem)!=null&&m.upgradeItemHrid&&S<h;){const a=new y({hrid:b.actionItem.upgradeItemHrid,project:D,action:O});if(!a.available)break;j.unshift(a),S++;const s=[...j.map(T=>p(T)),p(o)],w=new E(s,`${S}${u("步")}${I} → ${u("强化")}+${e}`);w.run(),$.push(w),b=a}L.result.profitPH>n&&(n=L.result.profitPH,c=L),$.forEach(a=>{const s=a.calculatorList.length-1;s>=2&&s<=h&&a.result.profitPH>d[s]&&(d[s]=a.result.profitPH,P[s]=a)})}}c&&C(t,c),g&&C(t,g);for(let l=2;l<=h;l++){const o=P[l];o&&C(t,o)}}return t}export{K as g};
